<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="description" content="Epusdt ç®¡ç†ç³»ç»Ÿ - USDTæ”¯ä»˜ç®¡ç†å¹³å°" />
  <title>Epusdt ç®¡ç†å°</title>

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts: Poppins + Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

  <style>
    * {
      font-family: 'Inter', 'Poppins', sans-serif;
    }

    h1, h2, h3, h4, h5, h6 {
      font-family: 'Poppins', sans-serif;
      font-weight: 600;
    }

    /* è‡ªå®šä¹‰Tailwindé…ç½® */
    :root {
      --color-dark-bg: #0f1218;
      --color-card-bg: #171c25;
      --color-border: #2a3444;
      --color-border-light: #222a36;
      --color-gold: #d4af37;
      --color-text-primary: #e6e6e6;
      --color-text-secondary: #a0a0a0;
      --color-success: #2ecc71;
      --color-error: #e74c3c;
      --color-warning: #f39c12;
    }

    body {
      background-color: var(--color-dark-bg);
      color: var(--color-text-primary);
    }

    /* è¾“å…¥å­—æ®µç„¦ç‚¹æ ·å¼ */
    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--color-gold) !important;
      box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
    }

    /* æŒ‰é’®æ‚¬åœæ•ˆæœ */
    button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(212, 175, 55, 0.15);
    }

    button:active:not(:disabled) {
      transform: translateY(0);
    }

    /* åŠ è½½åŠ¨ç”» */
    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    .animate-spin {
      animation: spin 1s linear infinite;
    }

    /* Soft UI é˜´å½± */
    .card-shadow {
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    }

    /* è¿‡æ¸¡åŠ¨ç”» */
    .transition-smooth {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    /* è¾“å…¥æ¡†æ ·å¼ */
    input, select, textarea {
      background-color: #10151f;
      color: var(--color-text-primary);
      border: 1px solid var(--color-border);
      transition: all 0.3s ease;
    }

    input::placeholder {
      color: var(--color-text-secondary);
    }

    /* é”™è¯¯çŠ¶æ€ */
    .input-error {
      border-color: var(--color-error) !important;
      background-color: rgba(231, 76, 60, 0.05);
    }

    /* Toasté€šçŸ¥ */
    .toast {
      position: fixed;
      top: 24px;
      right: 24px;
      padding: 16px 20px;
      border-radius: 8px;
      font-size: 14px;
      z-index: 50;
      animation: slideIn 0.3s ease-out;
    }

    @keyframes slideIn {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .toast-success {
      background-color: rgba(46, 204, 113, 0.2);
      border: 1px solid var(--color-success);
      color: var(--color-success);
    }

    .toast-error {
      background-color: rgba(231, 76, 60, 0.2);
      border: 1px solid var(--color-error);
      color: var(--color-error);
    }

    .toast-warning {
      background-color: rgba(243, 156, 18, 0.2);
      border: 1px solid var(--color-warning);
      color: var(--color-warning);
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header class="border-b border-opacity-20" style="border-color: var(--color-border); background-color: var(--color-card-bg);">
    <div class="max-w-7xl mx-auto px-6 py-4 flex justify-between items-center">
      <div class="flex items-center gap-3">
        <div class="w-10 h-10 rounded-lg flex items-center justify-center" style="background: linear-gradient(135deg, var(--color-gold), #b8860b);">
          <span class="text-lg font-bold text-black">â‚¿</span>
        </div>
        <h1 class="text-xl font-bold">Epusdt ç®¡ç†ç³»ç»Ÿ</h1>
      </div>
      <div id="userInfo" class="text-sm text-opacity-70"></div>
    </div>
  </header>

  <!-- Main Content -->
  <main class="min-h-screen">
    <!-- ç™»å½•å¡ç‰‡ -->
    <div id="loginCard" class="min-h-screen flex items-center justify-center px-4 py-12">
      <div class="w-full max-w-md card-shadow" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 16px; padding: 48px 32px;">
        <!-- Logoå’Œæ ‡é¢˜ -->
        <div class="text-center mb-8">
          <div class="inline-flex items-center justify-center w-16 h-16 rounded-full mb-4" style="background: linear-gradient(135deg, var(--color-gold), #b8860b);">
            <svg class="w-8 h-8 text-black" fill="currentColor" viewBox="0 0 20 20">
              <path d="M4 4a2 2 0 00-2 2v4a2 2 0 002 2V6h10a2 2 0 00-2-2H4zm2 6a2 2 0 012-2h8a2 2 0 012 2v4a2 2 0 01-2 2H8a2 2 0 01-2-2v-4zm0 4v2a2 2 0 002 2h8a2 2 0 002-2v-2H6z"></path>
            </svg>
          </div>
          <h2 class="text-2xl font-bold mb-2">ç®¡ç†å‘˜ç™»å½•</h2>
          <p class="text-sm" style="color: var(--color-text-secondary);">è®¿é—® USDT æ”¯ä»˜ç®¡ç†ç³»ç»Ÿ</p>
        </div>

        <!-- ç™»å½•è¡¨å• -->
        <form id="loginForm" onsubmit="handleLogin(event)" class="space-y-4">
          <!-- ç”¨æˆ·åè¾“å…¥ -->
          <div>
            <label for="loginUser" class="block text-sm font-medium mb-2">ç”¨æˆ·å</label>
            <div class="relative">
              <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5" style="color: var(--color-text-secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
              </svg>
              <input
                id="loginUser"
                type="text"
                placeholder="è¾“å…¥ç”¨æˆ·å"
                class="w-full pl-10 pr-4 py-3 rounded-lg transition-smooth"
                style="background-color: #10151f; border: 1px solid var(--color-border);"
                autocomplete="username"
                required
              />
            </div>
          </div>

          <!-- å¯†ç è¾“å…¥ -->
          <div>
            <label for="loginPass" class="block text-sm font-medium mb-2">å¯†ç </label>
            <div class="relative">
              <svg class="absolute left-3 top-1/2 transform -translate-y-1/2 w-5 h-5" style="color: var(--color-text-secondary);" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"></path>
              </svg>
              <input
                id="loginPass"
                type="password"
                placeholder="è¾“å…¥å¯†ç "
                class="w-full pl-10 pr-12 py-3 rounded-lg transition-smooth"
                style="background-color: #10151f; border: 1px solid var(--color-border);"
                autocomplete="current-password"
                required
              />
              <button
                type="button"
                id="togglePassword"
                class="absolute right-3 top-1/2 transform -translate-y-1/2 text-opacity-60 hover:text-opacity-100 transition-colors"
                style="color: var(--color-text-secondary);"
                aria-label="åˆ‡æ¢å¯†ç å¯è§æ€§"
              >
                <svg class="w-5 h-5" id="eyeIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
                </svg>
              </button>
            </div>
          </div>

          <!-- è®°ä½æˆ‘é€‰é¡¹ -->
          <div class="flex items-center gap-2">
            <input
              id="rememberMe"
              type="checkbox"
              class="w-4 h-4 rounded transition-smooth"
              style="background-color: #10151f; border: 1px solid var(--color-border); cursor: pointer; accent-color: var(--color-gold);"
            />
            <label for="rememberMe" class="text-sm cursor-pointer" style="color: var(--color-text-secondary);">
              è®°ä½æˆ‘ï¼ˆ7å¤©å†…è‡ªåŠ¨ç™»å½•ï¼‰
            </label>
            <button
              type="button"
              id="forgetMe"
              class="ml-auto text-xs font-medium transition-smooth hover:opacity-80"
              style="color: var(--color-warning); background: none; border: none; cursor: pointer; display: none;"
              onclick="forgetLogin()"
            >
              æ¸…é™¤è®°å½•
            </button>
          </div>

          <!-- é”™è¯¯æç¤º -->
          <div id="errorAlert" class="hidden p-3 rounded-lg text-sm transition-smooth" style="background-color: rgba(231, 76, 60, 0.1); border: 1px solid var(--color-error); color: var(--color-error);">
            <div class="flex items-center gap-2">
              <svg class="w-4 h-4 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd"></path>
              </svg>
              <span id="errorText">ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç </span>
            </div>
          </div>

          <!-- ç™»å½•æŒ‰é’® -->
          <button
            type="submit"
            id="loginBtn"
            class="w-full py-3 rounded-lg font-semibold transition-smooth flex items-center justify-center gap-2"
            style="background: linear-gradient(135deg, var(--color-gold), #b8860b); color: #000; border: none; cursor: pointer;"
          >
            <span id="btnText">ç™»å½•</span>
            <span id="btnSpinner" class="hidden animate-spin">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
            </span>
          </button>

          <!-- å¸®åŠ©é“¾æ¥ -->
          <div class="text-center text-sm" style="color: var(--color-text-secondary);">
            <p>é¦–æ¬¡ä½¿ç”¨ï¼Ÿ<span style="color: var(--color-gold); cursor: pointer;" onclick="showHelp()">æŸ¥çœ‹å¸®åŠ©</span></p>
          </div>
        </form>
      </div>
    </div>

    <!-- ç®¡ç†é¢æ¿ (ç™»å½•åæ˜¾ç¤º) -->
    <div id="adminPanel" class="hidden">
      <!-- ä¾§è¾¹æ å¯¼èˆª -->
      <div class="flex gap-0 min-h-screen" style="background-color: var(--color-dark-bg);">
        <aside class="w-64 border-r" style="border-color: var(--color-border); background-color: var(--color-card-bg);">
          <nav class="p-6 space-y-2">
            <button onclick="switchTab('walletTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth" style="background-color: var(--color-gold); color: #000;">
              ğŸ’° é’±åŒ…ç®¡ç†
            </button>
            <button onclick="switchTab('authTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              âœ… æˆæƒåˆ—è¡¨
            </button>
            <button onclick="switchTab('deductTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              ğŸ“Š æ‰£æ¬¾è®°å½•
            </button>
            <button onclick="switchTab('orderTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              ğŸ“¦ è®¢å•åˆ—è¡¨
            </button>
            <button onclick="switchTab('callbackTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              ğŸ“‹ å›è°ƒæ—¥å¿—
            </button>
            <button onclick="switchTab('userTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              ğŸ‘¤ ç”¨æˆ·ç®¡ç†
            </button>
            <button onclick="switchTab('merchantTab')" class="navBtn w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-text-primary);">
              ğŸª å•†å®¶ç®¡ç†
            </button>
            <hr class="my-4" style="border-color: var(--color-border);">
            <button onclick="logout()" class="w-full text-left px-4 py-2 rounded-lg text-sm font-medium transition-smooth hover:opacity-80" style="color: var(--color-error);">
              ğŸšª é€€å‡ºç™»å½•
            </button>
          </nav>
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <main class="flex-1 p-8">
          <!-- é’±åŒ…ç®¡ç† -->
          <section id="walletTab" class="tab-content">
            <div class="mb-6">
              <h2 class="text-2xl font-bold mb-4">é’±åŒ…ç®¡ç†</h2>
              <div class="flex gap-3 flex-wrap">
                <input id="walletToken" placeholder="é’±åŒ…åœ°å€" class="flex-1 min-w-48 px-4 py-2 rounded-lg" style="background-color: #10151f; border: 1px solid var(--color-border);" />
                <select id="walletChain" class="px-4 py-2 rounded-lg" style="background-color: #10151f; border: 1px solid var(--color-border);">
                  <option value="TRON">TRON</option>
                  <option value="BSC">BSC</option>
                  <option value="EVM">ETH</option>
                  <option value="POLYGON">POLYGON</option>
                </select>
                <button onclick="addWallet()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background: var(--color-gold); color: #000; border: none; cursor: pointer;">æ·»åŠ </button>
                <button onclick="loadWallets()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
              </div>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="walletTable" class="w-full"></table>
            </div>
          </section>

          <!-- æˆæƒåˆ—è¡¨ -->
          <section id="authTab" class="tab-content hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-2xl font-bold">æˆæƒåˆ—è¡¨</h2>
              <button onclick="loadAuthorizations()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="authTable" class="w-full"></table>
            </div>
          </section>

          <!-- æ‰£æ¬¾è®°å½• -->
          <section id="deductTab" class="tab-content hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-2xl font-bold">æ‰£æ¬¾è®°å½•</h2>
              <button onclick="loadDeductions()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="deductTable" class="w-full"></table>
            </div>
          </section>

          <!-- è®¢å•åˆ—è¡¨ -->
          <section id="orderTab" class="tab-content hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-2xl font-bold">è®¢å•åˆ—è¡¨</h2>
              <button onclick="loadOrders()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="orderTable" class="w-full"></table>
            </div>
          </section>

          <!-- å›è°ƒæ—¥å¿— -->
          <section id="callbackTab" class="tab-content hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-2xl font-bold">å›è°ƒæ—¥å¿—</h2>
              <button onclick="loadCallbacks()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="callbackTable" class="w-full"></table>
            </div>
          </section>

          <!-- ç”¨æˆ·ç®¡ç† -->
          <section id="userTab" class="tab-content hidden">
            <div class="mb-6">
              <h2 class="text-2xl font-bold mb-4">ç”¨æˆ·ç®¡ç†</h2>
              <div class="flex gap-3 flex-wrap">
                <input id="newUser" placeholder="ç”¨æˆ·å" class="flex-1 min-w-48 px-4 py-2 rounded-lg" style="background-color: #10151f; border: 1px solid var(--color-border);" />
                <input id="newPass" type="password" placeholder="å¯†ç " class="flex-1 min-w-48 px-4 py-2 rounded-lg" style="background-color: #10151f; border: 1px solid var(--color-border);" />
                <button onclick="createUser()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background: var(--color-gold); color: #000; border: none; cursor: pointer;">åˆ›å»º</button>
                <button onclick="loadUsers()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
              </div>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="userTable" class="w-full"></table>
            </div>
          </section>

          <!-- å•†å®¶ç®¡ç† -->
          <section id="merchantTab" class="tab-content hidden">
            <div class="mb-6 flex justify-between items-center">
              <h2 class="text-2xl font-bold">å•†å®¶ç®¡ç†</h2>
              <button onclick="loadMerchants()" class="px-6 py-2 rounded-lg font-semibold transition-smooth" style="background-color: var(--color-border); color: var(--color-text-primary); border: none; cursor: pointer;">åˆ·æ–°</button>
            </div>
            <div class="overflow-x-auto" style="background-color: var(--color-card-bg); border: 1px solid var(--color-border); border-radius: 8px;">
              <table id="merchantTable" class="w-full"></table>
            </div>
          </section>
        </main>
      </div>
    </div>
  </main>

  <script>
    // ============ å…¨å±€é…ç½® ============
    const tokenKey = 'epusdt_admin_token';
    const colorGold = '#d4af37';
    const colorError = '#e74c3c';
    const colorSuccess = '#2ecc71';

    // ============ å·¥å…·å‡½æ•° ============
    function getToken() {
      return localStorage.getItem(tokenKey);
    }

    function setToken(t) {
      localStorage.setItem(tokenKey, t);
    }

    function removeToken() {
      localStorage.removeItem(tokenKey);
    }

    function showToast(message, type = 'success', duration = 3000) {
      const toast = document.createElement('div');
      toast.className = `toast toast-${type}`;
      toast.textContent = message;
      document.body.appendChild(toast);

      setTimeout(() => {
        toast.style.animation = 'slideOut 0.3s ease-out forwards';
        setTimeout(() => toast.remove(), 300);
      }, duration);
    }

    function showError(message) {
      const errorAlert = document.getElementById('errorAlert');
      const errorText = document.getElementById('errorText');
      errorText.textContent = message;
      errorAlert.classList.remove('hidden');
    }

    function hideError() {
      document.getElementById('errorAlert').classList.add('hidden');
    }

    async function api(path, options = {}) {
      const headers = options.headers || {};
      if (getToken()) headers['Authorization'] = 'Bearer ' + getToken();
      headers['Content-Type'] = 'application/json';

      try {
        const res = await fetch(path, { ...options, headers });
        const data = await res.json();
        return data;
      } catch (err) {
        console.error('API Error:', err);
        return { status_code: 500, message: 'ç½‘ç»œé”™è¯¯' };
      }
    }

    // ============ ç™»å½•æ¨¡å— ============
    document.getElementById('togglePassword').addEventListener('click', function() {
      const passInput = document.getElementById('loginPass');
      const eyeIcon = document.getElementById('eyeIcon');

      if (passInput.type === 'password') {
        passInput.type = 'text';
        eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.494m5.858.908a3 3 0 11-4.243-4.243m9.968 10.75a10.05 10.05 0 01-1.949 2.75c-1.51 1.507-3.612 2.75-6.519 2.75-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-4.494m5.858.908a3 3 0 11-4.243-4.243m9.968 10.75A10.05 10.05 0 0112 5c-4.478 0-8.268 2.943-9.543 7a9.97 9.97 0 011.563 4.494"></path>';
      } else {
        passInput.type = 'password';
        eyeIcon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>';
      }
    });

    async function handleLogin(e) {
      e.preventDefault();
      hideError();

      const username = document.getElementById('loginUser').value.trim();
      const password = document.getElementById('loginPass').value.trim();
      const rememberMe = document.getElementById('rememberMe').checked;

      if (!username || !password) {
        showError('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º');
        return;
      }

      // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
      const loginBtn = document.getElementById('loginBtn');
      const btnText = document.getElementById('btnText');
      const btnSpinner = document.getElementById('btnSpinner');
      loginBtn.disabled = true;
      btnText.textContent = 'ç™»å½•ä¸­';
      btnSpinner.classList.remove('hidden');

      const data = await api('/admin/api/login', {
        method: 'POST',
        body: JSON.stringify({ username, password })
      });

      if (data.status_code === 200) {
        setToken(data.data.token);

        // å¦‚æœå‹¾é€‰äº†è®°ä½æˆ‘ï¼Œä¿å­˜ç”¨æˆ·åå’Œè¿‡æœŸæ—¶é—´ï¼ˆ7å¤©ï¼‰
        if (rememberMe) {
          const expiryTime = Date.now() + (7 * 24 * 60 * 60 * 1000); // 7å¤©
          localStorage.setItem('epusdt_remember_user', username);
          localStorage.setItem('epusdt_remember_expiry', expiryTime);
        } else {
          // æ¸…é™¤è®°ä½çš„ä¿¡æ¯
          localStorage.removeItem('epusdt_remember_user');
          localStorage.removeItem('epusdt_remember_expiry');
        }

        showToast('ç™»å½•æˆåŠŸï¼');
        setTimeout(() => init(), 500);
      } else {
        showError(data.message || 'ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç”¨æˆ·åå’Œå¯†ç ');
      }

      // æ¢å¤æŒ‰é’®çŠ¶æ€
      loginBtn.disabled = false;
      btnText.textContent = 'ç™»å½•';
      btnSpinner.classList.add('hidden');
    }

    function logout() {
      if (confirm('ç¡®å®šè¦é€€å‡ºç™»å½•å—ï¼Ÿ')) {
        removeToken();
        // é€€å‡ºç™»å½•æ—¶ä¹Ÿæ¸…é™¤è®°ä½çš„ä¿¡æ¯
        localStorage.removeItem('epusdt_remember_user');
        localStorage.removeItem('epusdt_remember_expiry');
        document.getElementById('adminPanel').classList.add('hidden');
        document.getElementById('loginCard').classList.remove('hidden');
        document.getElementById('loginUser').value = '';
        document.getElementById('loginPass').value = '';
        document.getElementById('rememberMe').checked = false;
        document.getElementById('forgetMe').style.display = 'none';
        showToast('å·²é€€å‡ºç™»å½•', 'success');
      }
    }

    // æ¸…é™¤è®°ä½çš„ç™»å½•ä¿¡æ¯
    function forgetLogin() {
      localStorage.removeItem('epusdt_remember_user');
      localStorage.removeItem('epusdt_remember_expiry');
      document.getElementById('rememberMe').checked = false;
      document.getElementById('forgetMe').style.display = 'none';
      showToast('å·²æ¸…é™¤è®°å½•', 'success');
    }

    // åŠ è½½è®°ä½çš„ç™»å½•ä¿¡æ¯
    function loadRememberedLogin() {
      const rememberUser = localStorage.getItem('epusdt_remember_user');
      const rememberExpiry = localStorage.getItem('epusdt_remember_expiry');

      // æ£€æŸ¥è®°å¿†æ˜¯å¦è¿‡æœŸ
      if (rememberUser && rememberExpiry && Date.now() < parseInt(rememberExpiry)) {
        document.getElementById('loginUser').value = rememberUser;
        document.getElementById('rememberMe').checked = true;
        document.getElementById('forgetMe').style.display = 'inline-block';
        // å…‰æ ‡ç§»åˆ°å¯†ç å­—æ®µ
        document.getElementById('loginPass').focus();
      } else {
        // æ¸…é™¤è¿‡æœŸçš„è®°å¿†
        localStorage.removeItem('epusdt_remember_user');
        localStorage.removeItem('epusdt_remember_expiry');
      }
    }

    // ============ æ ‡ç­¾é¡µåˆ‡æ¢ ============
    function switchTab(tabId) {
      // éšè—æ‰€æœ‰æ ‡ç­¾é¡µ
      document.querySelectorAll('.tab-content').forEach(tab => {
        tab.classList.add('hidden');
      });

      // æ˜¾ç¤ºå½“å‰æ ‡ç­¾é¡µ
      document.getElementById(tabId).classList.remove('hidden');

      // æ›´æ–°å¯¼èˆªæŒ‰é’®æ ·å¼
      document.querySelectorAll('.navBtn').forEach(btn => {
        btn.style.backgroundColor = 'transparent';
        btn.style.color = 'var(--color-text-primary)';
      });

      event.target.style.backgroundColor = colorGold;
      event.target.style.color = '#000';
    }

    // ============ é’±åŒ…ç®¡ç† ============
    async function addWallet() {
      const token = document.getElementById('walletToken').value.trim();
      const chain = document.getElementById('walletChain').value;

      if (!token) {
        showToast('è¯·è¾“å…¥é’±åŒ…åœ°å€', 'warning');
        return;
      }

      const data = await api('/api/v1/wallet/add', {
        method: 'POST',
        body: JSON.stringify({ token, chain })
      });

      showToast(data.message || 'æ·»åŠ æˆåŠŸ', data.status_code === 200 ? 'success' : 'error');
      if (data.status_code === 200) {
        document.getElementById('walletToken').value = '';
        loadWallets();
      }
    }

    async function loadWallets() {
      const data = await api('/api/v1/wallet/list', {
        method: 'POST',
        body: JSON.stringify({})
      });
      renderTable('walletTable', data.data || [], ['id', 'token', 'chain', 'status', 'created_at']);
    }

    // ============ æˆæƒç®¡ç† ============
    async function loadAuthorizations() {
      const data = await api('/admin/api/authorizations');
      renderTable('authTable', data.data || [], ['id', 'auth_no', 'password', 'merchant_wallet', 'customer_wallet', 'authorized_usdt', 'remaining_usdt', 'chain', 'status']);
    }

    // ============ æ‰£æ¬¾ç®¡ç† ============
    async function loadDeductions() {
      const data = await api('/admin/api/deductions');
      renderTable('deductTable', data.data || [], ['id', 'deduct_no', 'auth_no', 'amount_usdt', 'amount_cny', 'status', 'tx_hash', 'created_at']);
    }

    // ============ è®¢å•ç®¡ç† ============
    async function loadOrders() {
      const data = await api('/admin/api/orders');
      renderTable('orderTable', data.data || [], ['id', 'order_id', 'trade_id', 'amount', 'actual_amount', 'token', 'chain', 'status', 'block_transaction_id']);
    }

    // ============ å›è°ƒç®¡ç† ============
    async function loadCallbacks() {
      const data = await api('/admin/api/callbacks');
      renderTable('callbackTable', data.data || [], ['id', 'order_id', 'trade_id', 'notify_url', 'status_code', 'success', 'error_message', 'created_at']);
    }

    // ============ ç”¨æˆ·ç®¡ç† ============
    async function loadUsers() {
      const data = await api('/admin/api/users');
      renderTable('userTable', data.data || [], ['id', 'username', 'role_id', 'status', 'created_at']);
    }

    async function createUser() {
      const username = document.getElementById('newUser').value.trim();
      const password = document.getElementById('newPass').value.trim();

      if (!username || !password) {
        showToast('ç”¨æˆ·åå’Œå¯†ç ä¸èƒ½ä¸ºç©º', 'warning');
        return;
      }

      const data = await api('/admin/api/users', {
        method: 'POST',
        body: JSON.stringify({ username, password })
      });

      showToast(data.message || 'åˆ›å»ºæˆåŠŸ', data.status_code === 200 ? 'success' : 'error');
      if (data.status_code === 200) {
        document.getElementById('newUser').value = '';
        document.getElementById('newPass').value = '';
        loadUsers();
      }
    }

    // ============ å•†å®¶ç®¡ç† ============
    async function loadMerchants() {
      const data = await api('/admin/api/merchants');
      renderMerchantTable(data.data || []);
    }

    function renderMerchantTable(merchants) {
      const table = document.getElementById('merchantTable');
      if (!merchants || merchants.length === 0) {
        table.innerHTML = '<tr><td colspan="8" class="px-4 py-8 text-center" style="color: var(--color-text-secondary);">æš‚æ— å•†å®¶æ•°æ®</td></tr>';
        return;
      }

      const cols = ['ID', 'ç”¨æˆ·å', 'å•†å®¶åç§°', 'é‚®ç®±', 'ä½™é¢(USDT)', 'çŠ¶æ€', 'æœ€åç™»å½•', 'æ“ä½œ'];
      let html = '<thead style="border-bottom: 2px solid var(--color-border); background-color: rgba(212, 175, 55, 0.05);">';
      html += '<tr>' + cols.map(c => `<th class="px-4 py-3 text-left text-sm font-semibold">${c}</th>`).join('') + '</tr>';
      html += '</thead><tbody>';

      merchants.forEach((m, idx) => {
        const isBanned = m.status === 2;
        const statusBadge = isBanned
          ? '<span style="color: #e74c3c; font-weight: 600;">ğŸš« å·²å°ç¦</span>'
          : '<span style="color: #2ecc71; font-weight: 600;">âœ… æ­£å¸¸</span>';

        const lastLogin = m.last_login_at ? new Date(m.last_login_at * 1000).toLocaleString('zh-CN') : 'ä»æœªç™»å½•';

        const actionBtn = isBanned
          ? `<button onclick="toggleMerchantBan(${m.id}, 1)" class="px-3 py-1 rounded text-xs font-semibold transition-smooth" style="background: var(--color-success); color: #000; border: none; cursor: pointer;">è§£å°</button>`
          : `<button onclick="toggleMerchantBan(${m.id}, 2)" class="px-3 py-1 rounded text-xs font-semibold transition-smooth" style="background: var(--color-error); color: #fff; border: none; cursor: pointer;">å°ç¦</button>`;

        html += `<tr style="border-bottom: 1px solid var(--color-border); ${idx % 2 === 0 ? 'background-color: rgba(0,0,0,0.2)' : ''}">`;
        html += `<td class="px-4 py-3 text-sm">${m.id}</td>`;
        html += `<td class="px-4 py-3 text-sm">${m.username || ''}</td>`;
        html += `<td class="px-4 py-3 text-sm">${m.merchant_name || ''}</td>`;
        html += `<td class="px-4 py-3 text-sm">${m.email || ''}</td>`;
        html += `<td class="px-4 py-3 text-sm font-mono">${(m.balance || 0).toFixed(2)}</td>`;
        html += `<td class="px-4 py-3 text-sm">${statusBadge}</td>`;
        html += `<td class="px-4 py-3 text-sm">${lastLogin}</td>`;
        html += `<td class="px-4 py-3 text-sm">${actionBtn}</td>`;
        html += '</tr>';
      });

      html += '</tbody>';
      table.innerHTML = html;
    }

    async function toggleMerchantBan(merchantId, newStatus) {
      const action = newStatus === 2 ? 'å°ç¦' : 'è§£å°';
      if (!confirm(`ç¡®å®šè¦${action}è¯¥å•†å®¶å—ï¼Ÿ\n\n${newStatus === 2 ? 'å°ç¦åè¯¥å•†å®¶å°†æ— æ³•ç™»å½•ã€æ‰£æ¬¾å’Œæç°ã€‚' : 'è§£å°åè¯¥å•†å®¶å°†æ¢å¤æ­£å¸¸ä½¿ç”¨ã€‚'}`)) {
        return;
      }

      const data = await api('/admin/api/merchants/ban', {
        method: 'PUT',
        body: JSON.stringify({ id: merchantId, status: newStatus })
      });

      showToast(data.data || data.message || `${action}æ“ä½œå®Œæˆ`, data.status_code === 200 ? 'success' : 'error');
      if (data.status_code === 200) {
        loadMerchants();
      }
    }

    // ============ è¡¨æ ¼æ¸²æŸ“ ============
    function renderTable(id, rows, cols) {
      const table = document.getElementById(id);

      if (!rows || rows.length === 0) {
        table.innerHTML = `<tr><td colspan="${cols.length}" class="px-4 py-8 text-center" style="color: var(--color-text-secondary);">æš‚æ— æ•°æ®</td></tr>`;
        return;
      }

      let html = '<thead style="border-bottom: 2px solid var(--color-border); background-color: rgba(212, 175, 55, 0.05);">';
      html += '<tr>' + cols.map(c => `<th class="px-4 py-3 text-left text-sm font-semibold">${c}</th>`).join('') + '</tr>';
      html += '</thead><tbody>';

      rows.forEach((row, idx) => {
        html += `<tr style="border-bottom: 1px solid var(--color-border); ${idx % 2 === 0 ? 'background-color: rgba(0,0,0,0.2)' : ''}">`;
        cols.forEach(c => {
          let val = row[c] ?? '';
          // ç¼©çŸ­é•¿æ–‡æœ¬
          if (typeof val === 'string' && val.length > 50) {
            val = val.substring(0, 47) + '...';
          }
          html += `<td class="px-4 py-3 text-sm">${val}</td>`;
        });
        html += '</tr>';
      });

      html += '</tbody>';
      table.innerHTML = html;
    }

    // ============ åˆå§‹åŒ– ============
    async function init() {
      if (!getToken()) {
        document.getElementById('loginCard').classList.remove('hidden');
        document.getElementById('adminPanel').classList.add('hidden');
        loadRememberedLogin(); // åŠ è½½è®°ä½çš„ç™»å½•ä¿¡æ¯
        return;
      }

      const me = await api('/admin/api/me');
      if (me.status_code === 200) {
        document.getElementById('userInfo').textContent = `ğŸ‘¤ ${me.data.username}`;
        document.getElementById('loginCard').classList.add('hidden');
        document.getElementById('adminPanel').classList.remove('hidden');

        // åŠ è½½æ‰€æœ‰æ•°æ®
        loadWallets();
        loadAuthorizations();
        loadDeductions();
        loadOrders();
        loadCallbacks();
        loadUsers();
        loadMerchants();
      } else {
        removeToken();
        init();
      }
    }

    function showHelp() {
      showToast('è¯·è¾“å…¥ç®¡ç†å‘˜ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œç™»å½•', 'warning', 5000);
    }

    // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
    window.addEventListener('load', init);

    // æŒ‰Enteré”®æäº¤ç™»å½•è¡¨å•
    document.getElementById('loginForm').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') {
        handleLogin(e);
      }
    });
  </script>
</body>
</html>
